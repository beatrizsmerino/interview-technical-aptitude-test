<template>
	<form @submit.prevent="login">
		<div>
			<label for="email">Email:</label>
			<input
				type="email"
				id="email"
				v-model="email"
				required
			/>
		</div>

		<div>
			<label for="password">Contrase침a:</label>
			<input
				type="password"
				id="password"
				v-model="password"
				required
			/>
		</div>

		<button type="submit">Iniciar sesi칩n</button>

		<UIMessage :message="responseMessage" />
	</form>
</template>

<script>
import { mapMutations } from "vuex";
import UIMessage from "@/components/UI/UIMessage.vue";

export default {
	name: "SectionLogin",
	components: {
		UIMessage,
	},
	data() {
		return {
			email: "",
			password: "",
			responseMessage: "",
		};
	},
	methods: {
		...mapMutations(["setToken", "setLoggedIn"]),
		async login() {
			try {
				const response = await fetch(
					"https://backend.dev.woowbe.com/api/v1/auth/jwt/token/",
					{
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({
							email: this.email,
							password: this.password,
						}),
					},
				);
				if (response.ok) {
					const data = await response.json();
					this.setToken(data.token);
					this.responseMessage = "Inicio de sesi칩n exitoso";
					this.setLoggedIn(true);
					localStorage.setItem("token", data.token);
					this.$router.push("/account");
				} else {
					throw new Error(
						"Error al iniciar sesi칩n. Verifica tus credenciales.",
					);
				}
			} catch (error) {
				this.responseMessage = error.message;
			}
		},
	},
};
</script>
